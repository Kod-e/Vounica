考虑到整个项目会主要依赖FastAPI, 需要一套在发生错误时和客户端通讯的机制

在设计原则中, 项目不应该大量的使用try ... except... 这样的处理模式, 很多时候会在中间层捕获并且隐藏真实的问题,导致非常难维护

应该在代码层面让整个项目变的健壮, 并且从根源上减少异常的发生, 而不是捕获后处理

所以设计了这样的一套异常机制

这套异常机制主要由app/core/exception下的base作为基类, 定义了这样的几个value
code 一般这个等同于HTTP Code的概念, 如404, 401, 500...
message 一般是较为可读的自然语言, 用来给开发者阅读
error_type 一般是可读的字符串ASCII, 用来让客户端或者任何代码判断这个异常属于什么
detail 附加信息, 可以用于debug, 或者在某些上方无法覆盖时传递其他的, 是一个dict, 可以被简单的json化

考虑code会和FastAPI最终返回的code完全相同, 看起来像是多余的, 不过这个value依然是合理的

因为在架构设计层面上, 不止最终的http层会使用, 中间的其他层也有可能会使用这个code, 所以如果在异常最开始发生的时候, 后方的链就能更早的获取更多的信息, 而不是等到最后在http层加上

所以, 应该让最外部的fastapi来通过这个code加上http code



任何发生的异常都应该在抛到最外层并且让FastAPI返回, 不应该在中途增加任何捕获这个项目中的BaseExceptions并且中断向外传递的代码
如果某个问题会被捕获后处理, 那显然, 这个问题可以在异常发生的Source得到解决, 不应该抛到外面, 而是去处理源头 