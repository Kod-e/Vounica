import{m as T,g as L,h as N,d as E,i as B,p as x,w as j,b as C,c as l,e as b,a as e,t as n,k as t,q as P,s as M,v as k,x as $,y as U,F as _,r as w,o as d,j as z,n as D,l as F}from"./index-CzInviHJ.js";async function G(o,a){const c=T().targetLanguage,{data:r,error:g}=await L.POST("/v1/story/create",{body:{content:o,category:a,summary:"",language:c}});if(g)throw g;if(!r)throw new Error("Empty response");return r}async function O(){const{data:o,error:a}=await L.GET("/v1/story/categories");if(a)throw a;if(!o)throw new Error("Empty response");return o}async function q(o,a,s){const{data:c,error:r}=await L.GET("/v1/story/category/page",{params:{query:{category:o,offset:a,limit:s}}});if(r)throw r;if(!c)throw new Error("Empty response");return c}const A=N("story",{state:()=>({categories:[],selectedCategory:null,stories:[],offset:0,limit:30,isLoading:!1}),getters:{hasPrevPage:o=>o.offset>0,nowPage:o=>Math.floor(o.offset/o.limit)+1},actions:{async fetchCategories(){this.isLoading=!0;const o=await O();this.categories=o,this.isLoading=!1},async setFakeCategories(){this.categories=["test1","test2","test3"]},async fetchStoriesByCategory(){if(!this.selectedCategory)return;this.isLoading=!0;const o=await q(this.selectedCategory,this.offset,this.limit);this.stories=o,this.isLoading=!1},async selectCategory(o){this.isLoading=!0,this.selectedCategory=o,await this.fetchStoriesByCategory(),this.isLoading=!1},nextPage(){this.isLoading||(this.offset+=this.limit,this.fetchStoriesByCategory())},prevPage(){this.isLoading||this.offset-this.limit<0||(this.offset-=this.limit,this.fetchStoriesByCategory())},async createStory(o,a){if(!o?.trim())return;const s=a?.trim();if(s){this.isLoading=!0;try{const c=await G(o.trim(),s);return this.categories.includes(s)||this.categories.push(s),this.selectedCategory=s,this.offset=0,await this.fetchStoriesByCategory(),c}finally{this.isLoading=!1}}}}}),W={key:0,"aria-live":"assertive",class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6"},I={class:"relative w-full max-w-lg rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 p-5 space-y-4"},R={class:"flex items-center justify-between"},Y={class:"text-base font-semibold text-gray-900"},H={class:"space-y-3"},J={class:"block text-sm font-medium text-gray-700 mb-1"},K=["placeholder"],Q={class:"block text-sm font-medium text-gray-700 mb-1"},X={class:"flex gap-2"},Z=["value"],ee=["placeholder"],te={class:"flex justify-end gap-2 pt-2"},se=["disabled"],S="__NEW__",oe=E({__name:"StoryCreateOver",props:{open:{type:Boolean},tabs:{},loading:{type:Boolean}},emits:["close","confirm"],setup(o,{emit:a}){const s=o,c=a,{t:r}=B(),g=x(""),y=x(null),m=x("");j(()=>s.open,p=>{p&&(g.value="",y.value=s.tabs?.[0]?.name??null,m.value="")});const u=C(()=>!!s.loading),i=C(()=>y.value===S?m.value.trim():y.value?.trim()??"");function v(){c("close")}function V(){if(u.value)return;const p=i.value;!g.value.trim()||!p||c("confirm",{content:g.value.trim(),category:p})}return(p,h)=>p.open?(d(),l("div",W,[e("div",{class:"absolute inset-0 bg-black/30",onClick:v}),e("div",I,[e("div",R,[e("h3",Y,n(t(r)("addStory")),1),e("button",{type:"button",onClick:v,class:"inline-flex rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},[h[3]||(h[3]=e("span",{class:"sr-only"},"Close",-1)),P(t(M),{class:"h-5 w-5","aria-hidden":"true"})])]),e("div",H,[e("div",null,[e("label",J,n(t(r)("content")),1),k(e("textarea",{"onUpdate:modelValue":h[0]||(h[0]=f=>g.value=f),rows:"6",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:t(r)("content")},null,8,K),[[$,g.value]])]),e("div",null,[e("label",Q,n(t(r)("selectCategory")),1),e("div",X,[k(e("select",{"onUpdate:modelValue":h[1]||(h[1]=f=>y.value=f),class:"block w-1/2 rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm"},[(d(!0),l(_,null,w(p.tabs,f=>(d(),l("option",{key:f.name,value:f.name},n(f.name),9,Z))),128)),e("option",{value:S},n(t(r)("newCategory")),1)],512),[[U,y.value]]),y.value===S?k((d(),l("input",{key:0,"onUpdate:modelValue":h[2]||(h[2]=f=>m.value=f),type:"text",class:"block w-1/2 rounded-md border-gray-300 py-2 px-3 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm",placeholder:t(r)("inputNewCategory")},null,8,ee)),[[$,m.value]]):b("",!0)])])]),e("div",te,[e("button",{type:"button",class:"rounded-md px-3 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100",onClick:v},n(t(r)("cancel")),1),e("button",{type:"button",class:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-indigo-600",disabled:u.value||!g.value.trim()||!i.value,onClick:V},n(u.value?t(r)("creating"):t(r)("confirm")),9,se)])])])):b("",!0)}}),ie={class:"px-4 sm:px-6 lg:px-8"},ne={class:"sm:flex sm:items-center"},ae={class:"sm:flex-auto"},re={class:"text-base font-semibold leading-6 text-gray-900"},le={class:"mt-2 text-sm text-gray-700"},de={class:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none"},ce={key:0,class:"mt-8"},ue={key:1,class:"mt-8 flow-root"},ge={class:"sm:hidden"},me={for:"tabs",class:"sr-only"},fe={id:"tabs",name:"tabs",class:"block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm"},ye=["selected","onClick"],he={class:"hidden sm:block"},pe={class:"border-b border-gray-200"},ve={class:"-mb-px flex space-x-8","aria-label":"Tabs"},be=["onClick","aria-current"],xe={key:0,class:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},_e={role:"list",class:"divide-y divide-gray-100"},we={class:"min-w-0"},Ce={class:"text-sm/6 text-gray-900 break-all"},ke={class:"mt-2 flex items-center justify-between"},Se={class:"text-xs/5 text-gray-500"},Le={class:"text-xs/5 text-gray-500"},$e=["datetime"],Ee={class:"mt-8 flex justify-between"},Pe=E({__name:"StoryView",setup(o){const{t:a}=B(),s=A(),c=C(()=>s.categories.map(m=>({name:m}))),r=x(!1);z(()=>{s.fetchCategories()});const g=C(()=>s.stories);async function y(m){try{await s.createStory(m.content,m.category)}finally{r.value=!1}}return(m,u)=>(d(),l("div",ie,[e("div",ne,[e("div",ae,[e("h1",re,n(t(a)("story")),1),e("p",le,n(t(a)("storyViewDescription")),1)]),e("div",de,[e("button",{type:"button",class:"block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-indigo-600",onClick:u[0]||(u[0]=i=>r.value=!0)},n(t(a)("addStory")),1)])]),t(s).categories.length===0?(d(),l("div",ce,[e("p",null,n(t(a)("noCategory")),1)])):b("",!0),t(s).categories.length>0?(d(),l("div",ue,[e("div",null,[e("div",ge,[e("label",me,n(t(a)("selectCategory")),1),e("select",fe,[(d(!0),l(_,null,w(c.value,i=>(d(),l("option",{key:i.name,selected:i.name===t(s).selectedCategory,onClick:v=>t(s).selectCategory(i.name)},n(i.name),9,ye))),128))])]),e("div",he,[e("div",pe,[e("nav",ve,[(d(!0),l(_,null,w(c.value,i=>(d(),l("a",{key:i.name,onClick:v=>t(s).selectCategory(i.name),class:D([i.name===t(s).selectedCategory?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700","whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium"]),"aria-current":i.name===t(s).selectedCategory?"page":void 0},n(i.name),11,be))),128))])])])]),t(s).selectedCategory?(d(),l("div",xe,[e("ul",_e,[(d(!0),l(_,null,w(g.value,i=>(d(),l("li",{key:i.id,class:"py-5"},[e("div",we,[e("p",Ce,n(i.content),1)]),e("div",ke,[e("p",Se,n(t(a)("summary"))+": "+n(i.summary),1),e("p",Le,[F(n(t(a)("updated_at"))+" ",1),e("time",{datetime:i.updated_at},n(i.updated_at),9,$e)])])]))),128))])])):b("",!0)])):b("",!0),e("div",Ee,[e("button",{type:"button",class:"block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-indigo-600",onClick:u[1]||(u[1]=i=>t(s).prevPage())},n(t(s).isLoading?"Loading...":t(a)("prevPage")),1),e("button",{type:"button",class:"block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-indigo-600",onClick:u[2]||(u[2]=i=>t(s).nextPage())},n(t(s).isLoading?"Loading...":t(a)("nextPage")),1)]),P(oe,{open:r.value,tabs:c.value,loading:t(s).isLoading,onClose:u[3]||(u[3]=i=>r.value=!1),onConfirm:y},null,8,["open","tabs","loading"])]))}});export{Pe as default};
